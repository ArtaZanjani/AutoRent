import{a1 as I,a2 as M,a3 as z,r as d,e as P,j as e,a4 as R,a5 as F,L as $,B as L}from"./index-DwnwMVvo.js";import{Q as S,u as D}from"./useBaseQuery-CIX_lQms.js";import{B as J}from"./Breadcrumbs-B1urLlzM.js";import{B as C,a as O}from"./BlogCardSkeleton-Bn1D9_1_.js";import{F as A}from"./FetchErrorComp-jDHZc-xG.js";import{a as E}from"./Clock-3Gx5NdlO.js";import"./ArrowLeft2-BUOb-40Q.js";var Q=class extends S{constructor(t,a){super(t,a)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(t){super.setOptions({...t,behavior:I()})}getOptimisticResult(t){return t.behavior=I(),super.getOptimisticResult(t)}fetchNextPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"backward"}}})}createResult(t,a){var m,w;const{state:n}=t,c=super.createResult(t,a),{isFetching:h,isRefetching:N,isError:u,isRefetchError:y}=c,o=(w=(m=n.fetchMeta)==null?void 0:m.fetchMore)==null?void 0:w.direction,l=u&&o==="forward",x=h&&o==="forward",g=u&&o==="backward",j=h&&o==="backward";return{...c,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:z(a,n.data),hasPreviousPage:M(a,n.data),isFetchNextPageError:l,isFetchingNextPage:x,isFetchPreviousPageError:g,isFetchingPreviousPage:j,isRefetchError:y&&!l&&!g,isRefetching:N&&!x&&!j}}};function Z(t,a){return D(t,Q)}const V=async({pageParam:t=1})=>{try{const a=(t-1)*4,n=await fetch(`https://hjuhswhndfpjuztjabfm.supabase.co/rest/v1/blog?limit=4&offset=${a}&order=publishDate.desc,views.desc`,{headers:{apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhqdWhzd2huZGZwanV6dGphYmZtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA5NzgyNDAsImV4cCI6MjA2NjU1NDI0MH0.pNAixwBCETl9h7PyDhjJFpNwZDfSHLRbzFK5YJ9M0so","Content-Type":"application/json"}});if(!n.ok)throw new Error("Network response was not ok");return{data:await n.json(),nextPage:t+1}}catch(a){throw console.error("Fetch blogs error:",a),a}},K=()=>{const[t,a]=d.useState(""),[n,c]=d.useState(!1),[h,N]=d.useState([]),u=P("(min-width: 888px)"),y=P("(min-width: 1280px)"),o=P("(max-width: 1427px)"),{data:l,isLoading:x,isError:g,fetchNextPage:j,hasNextPage:k,isFetchingNextPage:m,refetch:w}=Z({queryKey:["blogs"],queryFn:V,getNextPageParam:s=>s.data.length===4?s.nextPage:void 0}),f=d.useMemo(()=>{const s=(l==null?void 0:l.pages.flatMap(i=>i.data))||[],r=new Set;return s.filter(i=>r.has(i.id)?!1:(r.add(i.id),!0))},[l]),B=d.useMemo(()=>{if(!t.trim())return f;const s=t.toLowerCase();return f.filter(r=>{var i,p;return((i=r.title)==null?void 0:i.toLowerCase().includes(s))||((p=r.summary)==null?void 0:p.toLowerCase().includes(s))})},[t,f]),v=d.useMemo(()=>[...f].sort((s,r)=>{const i=new Date(s.publishDate),p=new Date(r.publishDate);return p-i!==0?p-i:(r.views||0)-(s.views||0)}),[f]),b=s=>{N(r=>[...new Set([...r,s])])};return g?e.jsx(A,{refetch:w}):e.jsxs("main",{className:"w-full min-h-screen",children:[e.jsx(J,{title:"جزئیات محصول",crumbs:[{path:"/blog",title:"مقالات"}]}),e.jsxs("div",{className:"flex flex-col-reverse items-start w-full gap-6 xl:flex-row Padding",children:[e.jsx("div",{className:"flex-1 xl:flex-2",children:x?e.jsx("div",{className:`w-full flex flex-row ${u?"justify-between":"justify-center"} flex-wrap items-start gap-x-6 gap-y-4`,children:Array.from({length:4}).map((s,r)=>e.jsx(C,{},r))}):B.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`w-full flex flex-row ${u?"justify-between":"justify-center"} flex-wrap items-start gap-x-6 gap-y-4`,children:[B.map(s=>e.jsx(O,{blog:s},s.id)),m&&Array.from({length:4}).map((s,r)=>e.jsx(C,{},r))]}),k&&e.jsx("button",{onClick:()=>j(),className:`btnBase btn-fill-primary h-11 px-4 mt-8 ${y&&o?"":"mx-auto"}`,disabled:m,children:"مشاهده بیشتر"})]}):e.jsx("p",{className:"mt-4 text-center text-gray-400",children:"مقاله‌ای یافت نشد."})}),e.jsxs("div",{className:"w-full space-y-6 xl:flex-1 xl:w-fit",children:[e.jsxs("div",{className:"relative w-full",children:[e.jsx("label",{className:`absolute transition-all pointer-events-none right-2 bg-white px-2 ${n||t.length>0?"text-sm -top-2.5 translate-y-0 text-neutral-gray-10":"top-1/2 text-neutral-gray-5 text-base -translate-y-1/2"}`,children:"جستجو در سایت اجاره خودرو اتورنت"}),e.jsx("input",{value:t,type:"text",className:`w-full text-sm font-medium inpBase !rounded-2xl h-14 bg-white border transition-all ${n||t.length>0?"border-neutral-gray-10":"border-neutral-gray-4"}`,onFocus:()=>c(!0),onBlur:()=>c(!1),onChange:s=>a(s.target.value)}),e.jsx("div",{className:"absolute left-0 px-3 -translate-y-1/2 pointer-events-none top-1/2",children:e.jsx(R,{className:`size-6 stroke-neutral-gray-5 transition-all ${n||t.length>0?"stroke-neutral-gray-10":"stroke-neutral-gray-5"}`})})]}),e.jsxs("div",{className:"w-full h-[568px] border border-neutral-gray-4 shadow-2xl rounded-2xl p-4 !pb-16 overflow-hidden",children:[e.jsx("h1",{className:"text-2xl font-black text-neutral-gray-10",children:"آخرین مقالات"}),x?e.jsx("div",{className:"flex flex-col justify-between h-full mt-4",children:Array.from({length:4}).map((s,r)=>e.jsxs("div",{className:"w-full animate-pulse rounded-xl flex items-center p-2 gap-x-3.5 border border-neutral-gray-3",children:[e.jsx("div",{className:"w-20.5 h-20.5 rounded-lg overflow-hidden bg-neutral-gray-3"}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx("div",{className:"w-3/4 h-4 rounded bg-neutral-gray-3"}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(E,{className:"size-5 stroke-neutral-gray-6"}),e.jsx("div",{className:"w-10 h-3 rounded bg-neutral-gray-3"})]}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(F,{className:"size-5 stroke-neutral-gray-6"}),e.jsx("div",{className:"w-10 h-3 rounded bg-neutral-gray-3"})]})]})]})]},r))}):v.length>0?e.jsx("div",{className:"flex flex-col justify-between h-full mt-4",children:v.slice(0,4).map((s,r)=>{var i;return e.jsx("div",{className:`w-full p-2 ${r!==v.length-1&&"border-b border-neutral-gray-3"}`,children:e.jsxs($,{to:`/blog/${s==null?void 0:s.id}`,className:"w-full h-full flex items-center gap-x-3.5",children:[e.jsx("div",{className:`w-20.5 h-20.5 rounded-lg overflow-hidden ${h.includes(s==null?void 0:s.id)?"bg-primary/10 px-1":""}`,children:e.jsx(L,{src:s.image,alt:s.title,onError:()=>b(s==null?void 0:s.id),className:`w-full h-full ${h.includes(s==null?void 0:s.id)?"object-contain":"object-cover"}`})}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsx("p",{className:"text-sm font-medium text-neutral-gray-9 line-clamp-2",children:s==null?void 0:s.title}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(E,{className:"size-5 stroke-neutral-gray-6"}),e.jsx("p",{className:"text-sm text-neutral-gray-6",children:s==null?void 0:s.reading_time})]}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(F,{className:"size-5 stroke-neutral-gray-6"}),e.jsx("p",{className:"text-sm text-neutral-gray-6",children:(i=s==null?void 0:s.views)==null?void 0:i.toLocaleString()})]})]})]})]})},s==null?void 0:s.id)})}):e.jsx("p",{className:"mt-4 text-center text-gray-400",children:"مقاله‌ای یافت نشد."})]})]})]})]})};export{K as default};
