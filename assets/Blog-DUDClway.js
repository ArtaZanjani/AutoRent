import{a3 as F,a4 as C,a5 as R,r as u,e as P,j as e,a6 as S,a7 as b,L,B as _}from"./index-Bjq59ByK.js";import{Q,u as D}from"./useBaseQuery-CMD__tK6.js";import{B as O}from"./Breadcrumbs-BGgnBIh5.js";import{B as E,a as z}from"./BlogCardSkeleton-CMaD60JV.js";import{F as I}from"./FetchErrorComp-BD4bGyty.js";import{a as $}from"./Clock-B13g_s1Y.js";import"./ArrowLeft2-D2tmDJND.js";var A=class extends Q{constructor(s,a){super(s,a)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(s){super.setOptions({...s,behavior:F()})}getOptimisticResult(s){return s.behavior=F(),super.getOptimisticResult(s)}fetchNextPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(s){return this.fetch({...s,meta:{fetchMore:{direction:"backward"}}})}createResult(s,a){var f,j;const{state:n}=s,l=super.createResult(s,a),{isFetching:x,isRefetching:y,isError:h,isRefetchError:N}=l,d=(j=(f=n.fetchMeta)==null?void 0:f.fetchMore)==null?void 0:j.direction,c=h&&d==="forward",m=x&&d==="forward",g=h&&d==="backward",w=x&&d==="backward";return{...l,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:R(a,n.data),hasPreviousPage:C(a,n.data),isFetchNextPageError:c,isFetchingNextPage:m,isFetchPreviousPageError:g,isFetchingPreviousPage:w,isRefetchError:N&&!c&&!g,isRefetching:y&&!m&&!w}}};function q(s,a){return D(s,A)}const K=async({pageParam:s=1})=>{try{const a=await fetch(`https://autorent-db.onrender.com/blog?_page=${s}&_limit=4&_sort=publishDate,views&_order=desc,desc`);if(!a.ok)throw new Error("Network response was not ok");const n=await a.json(),l=a.headers.get("x-total-count");return{data:n,nextPage:s+1,total:parseInt(l)}}catch(a){throw console.error("Fetch blogs error:",a),a}},X=()=>{const[s,a]=u.useState(""),[n,l]=u.useState(!1),[x,y]=u.useState([]),h=P("(min-width: 888px)"),N=P("(min-width: 1280px)"),d=P("(max-width: 1427px)"),{data:c,isLoading:m,isError:g,fetchNextPage:w,hasNextPage:k,isFetchingNextPage:f,refetch:j}=q({queryKey:["blogs"],queryFn:K,getNextPageParam:(t,r)=>r.flatMap(o=>o.data).length<t.total?t.nextPage:void 0}),p=u.useMemo(()=>{const t=(c==null?void 0:c.pages.flatMap(i=>i.data))||[],r=new Set;return t.filter(i=>r.has(i.id)?!1:(r.add(i.id),!0))},[c]),B=u.useMemo(()=>{if(!s.trim())return p;const t=s.toLowerCase();return p.filter(r=>{var i,o;return((i=r.title)==null?void 0:i.toLowerCase().includes(t))||((o=r.summary)==null?void 0:o.toLowerCase().includes(t))})},[s,p]),v=u.useMemo(()=>[...p].sort((t,r)=>{const i=new Date(t.publishDate),o=new Date(r.publishDate);return o-i!==0?o-i:(r.views||0)-(t.views||0)}),[p]),M=t=>{y(r=>[...new Set([...r,t])])};return g?e.jsx(I,{refetch:j}):e.jsxs("main",{className:"w-full min-h-screen",children:[e.jsx(O,{title:"جزئیات محصول",crumbs:[{path:"/blog",title:"مقالات"}]}),e.jsxs("div",{className:"w-full flex-col-reverse xl:flex-row flex items-start gap-6 Padding",children:[e.jsx("div",{className:"flex-1 xl:flex-2",children:m?e.jsx("div",{className:`w-full flex flex-row ${h?"justify-between":"justify-center"} flex-wrap items-start gap-x-6 gap-y-4`,children:Array.from({length:4}).map((t,r)=>e.jsx(E,{},r))}):B.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`w-full flex flex-row ${h?"justify-between":"justify-center"} flex-wrap items-start gap-x-6 gap-y-4`,children:[B.map(t=>e.jsx(z,{blog:t},t.id)),f&&Array.from({length:4}).map((t,r)=>e.jsx(E,{},r))]}),k&&e.jsx("button",{onClick:()=>w(),className:`btnBase btn-fill-primary h-11 px-4 mt-8 ${N&&d?"":"mx-auto"}`,disabled:f,children:"مشاهده بیشتر"})]}):e.jsx("p",{className:"text-center text-gray-400 mt-4",children:"مقاله‌ای یافت نشد."})}),e.jsxs("div",{className:"xl:flex-1 xl:w-fit w-full space-y-6",children:[e.jsxs("div",{className:"relative w-full",children:[e.jsx("label",{className:`absolute transition-all pointer-events-none right-2 bg-white px-2 ${n||s.length>0?"text-sm -top-2.5 translate-y-0 text-neutral-gray-10":"top-1/2 text-neutral-gray-5 text-base -translate-y-1/2"}`,children:"جستجو در سایت اجاره خودرو اتورنت"}),e.jsx("input",{value:s,type:"text",className:`w-full text-sm font-medium inpBase !rounded-2xl h-14 bg-white border transition-all ${n||s.length>0?"border-neutral-gray-10":"border-neutral-gray-4"}`,onFocus:()=>l(!0),onBlur:()=>l(!1),onChange:t=>a(t.target.value)}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 left-0 px-3 pointer-events-none",children:e.jsx(S,{className:`size-6 stroke-neutral-gray-5 transition-all ${n||s.length>0?"stroke-neutral-gray-10":"stroke-neutral-gray-5"}`})})]}),e.jsxs("div",{className:"w-full h-[568px] border border-neutral-gray-4 shadow-2xl rounded-2xl p-4 !pb-16 overflow-hidden",children:[e.jsx("h1",{className:"text-neutral-gray-10 font-black text-2xl",children:"آخرین مقالات"}),m?e.jsx("div",{className:"mt-4 flex flex-col justify-between h-full",children:Array.from({length:4}).map((t,r)=>e.jsxs("div",{className:"w-full animate-pulse rounded-xl flex items-center p-2 gap-x-3.5 border border-neutral-gray-3",children:[e.jsx("div",{className:"w-20.5 h-20.5 rounded-lg overflow-hidden bg-neutral-gray-3"}),e.jsxs("div",{className:"space-y-3 flex-1",children:[e.jsx("div",{className:"h-4 bg-neutral-gray-3 rounded w-3/4"}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx($,{className:"size-5 stroke-neutral-gray-6"}),e.jsx("div",{className:"h-3 bg-neutral-gray-3 rounded w-10"})]}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(b,{className:"size-5 stroke-neutral-gray-6"}),e.jsx("div",{className:"h-3 bg-neutral-gray-3 rounded w-10"})]})]})]})]},r))}):v.length>0?e.jsx("div",{className:"mt-4 flex flex-col justify-between h-full",children:v.slice(0,4).map((t,r)=>{var i;return e.jsx("div",{className:`w-full p-2 ${r!==v.length-1&&"border-b border-neutral-gray-3"}`,children:e.jsxs(L,{to:`/blog/${t==null?void 0:t.id}`,className:"w-full h-full flex items-center gap-x-3.5",children:[e.jsx("div",{className:`w-20.5 h-20.5 rounded-lg overflow-hidden ${x.includes(t==null?void 0:t.id)?"bg-primary/10 px-1":""}`,children:e.jsx(_,{src:`https://autorent-db.onrender.com/public/blog/${t.image}`,alt:t.title,onError:()=>M(t==null?void 0:t.id),className:`w-full h-full ${x.includes(t==null?void 0:t.id)?"object-contain":"object-cover"}`})}),e.jsxs("div",{className:"space-y-3 flex-1",children:[e.jsx("p",{className:"text-neutral-gray-9 font-medium line-clamp-2 text-sm",children:t==null?void 0:t.title}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx($,{className:"size-5 stroke-neutral-gray-6"}),e.jsx("p",{className:"text-neutral-gray-6 text-sm",children:t==null?void 0:t.reading_time})]}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(b,{className:"size-5 stroke-neutral-gray-6"}),e.jsx("p",{className:"text-neutral-gray-6 text-sm",children:(i=t==null?void 0:t.views)==null?void 0:i.toLocaleString()})]})]})]})]})},t==null?void 0:t.id)})}):e.jsx("p",{className:"text-center text-gray-400 mt-4",children:"مقاله‌ای یافت نشد."})]})]})]})]})};export{X as default};
